<table class="uk-table uk-table-hover uk-table-small uk-table-divider">
    <thead>
    <tr>
        <th class="uk-width-medium">建筑名</th>
        <th class="uk-width-medium uk-visible@s">建筑面积</th>
        <th class="uk-width-medium uk-visible@m">介绍</th>
        <th class="uk-width-medium uk-visible@l">建筑时间</th>
        <th class="uk-width-small">状态</th>
        {% if '%declaration_buildings_modify%' in permissions %}
            <th class="uk-width-small uk-visible@s">操作</th>
        {% endif %}
    </tr>
    </thead>
    <tbody>

    {% for b in buildings %}
        <tr>
            <td>
                <div class="uk-grid-small uk-flex-middle" uk-grid>
                    <div class="uk-width-auto">
                        <a>
                            <img class="uk-preserve-width uk-border-circle"
                                 src="{{ b.logo }}" width="40" alt="" id="building{{ b.id }}"
                                 onclick="buildingDetail(this.id)">
                        </a>
                    </div>
                    <div class="uk-width-expand">
                        <h4 class="uk-margin-remove-bottom"><a id="building{{ b.id }}" class="uk-link-reset"
                                                               onclick="buildingDetail(this.id)">{{ b.name }}</a>
                        </h4>
                        <p class="uk-text-meta uk-margin-remove-top">{{ b.english_name }}</p>
                    </div>
                </div>
            </td>
            <td class="nowrap uk-visible@s">
                <div class="uk-grid-small uk-flex-middle" uk-grid>
                    <div class="uk-width-expand">
                        <h4 class="uk-margin-remove-bottom">{{ b.area }} M<sup>2</sup></h4>
                        <p class="uk-text-meta uk-margin-remove-top">XYZ: {{ b.coordinate }}</p>
                    </div>
                </div>
            </td>
            <td class="nowrap uk-visible@m">
                <div class="uk-grid-small uk-flex-middle" uk-grid>
                    <div class="uk-width-expand">
                        <h4 class="uk-margin-remove-bottom"><a id="building{{ b.id }}" class="uk-link-reset"
                                                               onclick="buildingDetail(this.id)">{{ b.summary }}</a>
                        </h4>
                        <p class="uk-text-truncate uk-text-meta uk-margin-remove-top">
                            {{ b.detail }}</p>
                    </div>
                </div>
            </td>
            <td class="nowrap uk-visible@l">
                <div class="uk-grid-small uk-flex-middle" uk-grid>
                    <div class="uk-width-expand">
                        <a id="building{{ b.id }}" class="uk-link-reset"
                           onclick="buildingDetail(this.id)">
                            <p class="uk-text-meta uk-margin-remove-bottom uk-margin-remove-top">
                                开工：{{ b.predict_start_time }}</p>
                            <p class="uk-text-meta uk-margin-remove-bottom uk-margin-remove-top">
                                结束：{{ b.predict_end_time }}</p>
                        </a>
                    </div>
                </div>
            </td>
            <td>
                <span class="uk-label {{ b.status_label }}"
                      style="vertical-align: middle">{{ b.status_text }}</span>
            </td>
            {% if '%declaration_buildings_modify%' in permissions %}
                <td class="uk-visible@s">
                    <label>
                        <select class="uk-select building_options" _id="{{ b.id }}">
                            <option value="-1">...</option>
                            <option value="1">正在审核</option>
                            <option value="2">审核不通过</option>
                            <option value="3">审核通过</option>
                            <option value="4">正在建设</option>
                            <option value="5">完工</option>
                            <option value="6">弃坑</option>
                        </select>
                    </label>
                </td>
                
            {% endif %}
        </tr>
    {% endfor %}
    </tbody>
</table>
{% autoescape off %}{{ page }}{% endautoescape %}
<script>
        $(".del").click(function() {
            var _this = $(this);
            $.post("declare/buildings_del?_=" + Date.parse(new Date()), {
                "id":_this.attr("_id")
            }, function(obj) {
                if (obj.status === "ok") {
                    UIkit.notification({
                        message: '<span uk-icon=\'icon: check\'></span> ' + obj.msg,
                        status: 'success',
                        timeout: 2000
                    });
                    _this.parents("tr").remove();
                } else {
                    UIkit.notification({
                        message: '<span uk-icon=\'icon: close\'></span> ' + obj.msg,
                        status: 'danger',
                        timeout: 2000
                    })
                }
            }, "json")
        });

        function buildingDetail(id_) {
            var id = id_.substring(8);
            console.log(id);
            $.get("/buildings_detail", {
                "id": id
            }, function (data) {
                UIkit.modal.dialog(data);
            });
        }
        $(".building_options").change(function () {
            $.post("declare/buildings_change_status?_=" + Date.parse(new Date()), {
                "id": $(this).attr('_id'),
                "status": $(this).val()
            }, function (obj) {
                if (obj.status === "ok") {
                    UIkit.notification({
                        message: '<span uk-icon=\'icon: check\'></span> ' + obj.msg,
                        status: 'success',
                        timeout: 2000
                    });
                } else {
                    UIkit.notification({
                        message: '<span uk-icon=\'icon: close\'></span> ' + obj.msg,
                        status: 'danger',
                        timeout: 2000
                    })
                }
            }, "json")
        });
</script>