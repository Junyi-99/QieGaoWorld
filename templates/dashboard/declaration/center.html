{% load static %}
<h2>申报中心
    <small style="color: #666666; font-size: medium">Declaration Center</small>
</h2>
<hr class="uk-margin"/>
<p class="uk-text-meta">各位村民，这里是申报大厅，你可以查看所有玩家的申报项目。</p>
<ul uk-tab>
    <li class="uk-active"><a href="#">建筑申报</a></li>
    <li><a href="#">动物申报</a></li>
    <li><a href="#">头颅定制</a></li>
    <li><a href="#">地图定制</a></li>
</ul>
{#TODO: 把这些个表单什么的，分离开，让代码复用率变高。就是把center.html的和buildings.html的#}
{#TODO: 和animals.html的合起来用一个，比如叫“BuildingList.html” 然后 include这个buildinglist.html#}
<ul class="uk-switcher uk-margin">
    <li class="uk-active">
        <div class="uk-overflow-auto">
            <table class="uk-table uk-table-hover uk-table-small uk-table-divider">
                <thead>
                <tr>
                    <th class="uk-width-medium">建筑名</th>
                    <th class="uk-width-medium uk-visible@s">建筑面积</th>
                    <th class="uk-width-medium uk-visible@m">介绍</th>
                    <th class="uk-width-medium uk-visible@l">建筑时间</th>
                    <th class="uk-width-small">状态</th>
                    {% if '%declaration_buildings_modify%' in permissions %}
                        <th class="uk-width-small uk-visible@s">操作</th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>

                {% for b in buildings %}
                    <tr>
                        <td>
                            <div class="uk-grid-small uk-flex-middle" uk-grid>
                                <div class="uk-width-auto">
                                    <a>
                                        <img class="uk-preserve-width uk-border-circle"
                                             src="{{ b.logo }}" width="40" alt="" id="building{{ b.id }}"
                                             onclick="buildingDetail(this.id)">
                                    </a>
                                </div>
                                <div class="uk-width-expand">
                                    <h4 class="uk-margin-remove-bottom"><a id="building{{ b.id }}" class="uk-link-reset"
                                                                           onclick="buildingDetail(this.id)">{{ b.name }}</a>
                                    </h4>
                                    <p class="uk-text-meta uk-margin-remove-top">{{ b.english_name }}</p>
                                </div>
                            </div>
                        </td>
                        <td class="nowrap uk-visible@s">
                            <div class="uk-grid-small uk-flex-middle" uk-grid>
                                <div class="uk-width-expand">
                                    <h4 class="uk-margin-remove-bottom">{{ b.area }} M<sup>2</sup></h4>
                                    <p class="uk-text-meta uk-margin-remove-top">XYZ: {{ b.coordinate }}</p>
                                </div>
                            </div>
                        </td>
                        <td class="nowrap uk-visible@m">
                            <div class="uk-grid-small uk-flex-middle" uk-grid>
                                <div class="uk-width-expand">
                                    <h4 class="uk-margin-remove-bottom"><a id="building{{ b.id }}" class="uk-link-reset"
                                                                           onclick="buildingDetail(this.id)">{{ b.summary }}</a>
                                    </h4>
                                    <p class="uk-text-truncate uk-text-meta uk-margin-remove-top">
                                        {{ b.detail }}</p>
                                </div>
                            </div>
                        </td>
                        <td class="nowrap uk-visible@l">
                            <div class="uk-grid-small uk-flex-middle" uk-grid>
                                <div class="uk-width-expand">
                                    <a id="building{{ b.id }}" class="uk-link-reset"
                                       onclick="buildingDetail(this.id)">
                                        <p class="uk-text-meta uk-margin-remove-bottom uk-margin-remove-top">
                                            开工：{{ b.predict_start_time }}</p>
                                        <p class="uk-text-meta uk-margin-remove-bottom uk-margin-remove-top">
                                            结束：{{ b.predict_end_time }}</p>
                                    </a>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="uk-label {{ b.status_label }}"
                                  style="vertical-align: middle">{{ b.status_text }}</span>
                        </td>
                        {% if '%declaration_buildings_modify%' in permissions %}
                            <td class="uk-visible@s">
                                <label>
                                    <select class="uk-select building_options" _id="{{ b.id }}">
                                        <option value="-1">...</option>
                                        <option value="1">正在审核</option>
                                        <option value="2">审核不通过</option>
                                        <option value="3">审核通过</option>
                                        <option value="4">正在建设</option>
                                        <option value="5">完工</option>
                                        <option value="6">弃坑</option>
                                    </select>
                                </label>
                            </td>
                            
                        {% endif %}
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </li>
    <li>
        <div class="uk-overflow-auto">
            <table class="uk-table uk-table-divider uk-table-striped uk-table-hover">
                <thead>
                <tr>
                    <th class="uk-table-expand">牌照号</th>
                    <th class="uk-visible@s">隶属</th>
                    <th class="uk-visible@s uk-table-expand">特征</th>
                    <th class="uk-table-small">状态</th>
                    <th class="uk-visible@l">申请人</th>
                    <th class="uk-visible@l">申请时间</th>
                    {% if '%declaration_animals_modify%' in permissions %}
                        <th class="uk-width-small uk-visible@s">操作</th>
                    {% endif %}
                </tr>
                </thead>
                <tbody>
                {% for a in animals %}
                    <tr>
                        <td class="uk-text-truncate">{{ a.license }}</td>
                        <td class="uk-visible@s">{{ a.binding }}</td>
                        <td class="uk-visible@s uk-text-truncate">{{ a.feature }}</td>
                        <td><span class="uk-text-truncate uk-label {{ a.status_label }}">{{ a.status_text }}</span></td>
                        <td class="uk-visible@l">{{ a.nickname }}</td>
                        <td class="uk-visible@l">{{ a.declare_time }}</td>
                        {% if '%declaration_animals_modify%' in permissions %}
                            <td class="uk-visible@s">
                                <label>
                                    <select class="uk-select animal_options" _id="{{ a.id }}">
                                        <option value="0" {% if a.status == 0 %} selected {% endif %}>未知</option>
                                        <option value="1" {% if a.status == 1 %} selected {% endif %}>存活</option>
                                        <option value="2" {% if a.status == 2 %} selected {% endif %}>丢失</option>
                                        <option value="3" {% if a.status == 3 %} selected {% endif %}>死亡</option>
                                    </select>
                                </label>
                                <a  class="uk-margin-small-right uk-icon-link del" _id="{{ a.id }}" style="color:red" uk-icon="trash" title="删除"></a>
                            </td>
                        {% endif %}
                        <!-- <td><button class="uk-button uk-button-default uk-button-primary uk-align-right" uk-toggle="target: #edit-box">新增</button></td> -->
                        <td></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </li>
    <li>
        <div class="uk-overflow-auto">
            <table class="uk-table uk-table-divider uk-table-striped uk-table-hover">
                <thead>
                <tr>
                    
                    <th class="uk-visible@s">自定义名称</th>
                    <th class="uk-visible@s uk-table-expand">数量</th>
                    <th class="uk-table-small">状态</th>
                    <th class="uk-visible@s">申请人</th>
                </tr>
                </thead>
                <tbody>
                {% for a in skull %}
                    <tr>
                        <td class="uk-text-truncate">{{ a.name }}</td>
                        <td class="uk-visible@s">{{ a.number }}</td>
                        <td><span class="uk-text-truncate uk-label {{ a.status_class }}">{{ a.status_text }}</span></td>
                        <td class="uk-visible@s">{{ a.nickname }}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </li>
    <li>
        <div class="uk-overflow-auto">
                <table class="uk-table uk-table-divider uk-table-striped uk-table-hover">
                    <thead>
                    <tr>
                        <th class="uk-width-medium">编号</th>
                        <th class="uk-width-medium">缩略图</th>
                        <th class="uk-width-small">定制用户</th>
                        <th class="uk-width-small">状态</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for b in maps %}
                        <tr>
                            <td class="nowrap uk-visible@m">
                                {{ b.mapid }}
                            </td>
                            <td class="nowrap uk-visible@m">
                                {{ b.nickname }}
                            </td>
                            <td class="nowrap uk-visible@m">
                                <img src="{{ b.img }}" alt="">
                            </td>
                            <td>
                                            <span class="uk-label {{ b.status_label }}"
                                                    style="vertical-align: middle">{{ b.status_text }}</span>
                            </td>
                        </tr>
                    {% endfor %}
                    </tbody>
                </table>
        </div>
    </li>
</ul>
<script>
    function buildingDetail(id_) {
        var id = id_.substring(8);
        console.log(id_);
        $.get("/buildings_detail", {
            "id": id
        }, function (data) {
            UIkit.modal.dialog(data);
        });
    }

    $(document).ready(
        $(function () {
            $(".building_options").change(function () {
                $.post("declare/buildings_change_status?_=" + Date.parse(new Date()), {
                    "id": $(this).attr('_id'),
                    "status": $(this).val()
                }, function (obj) {
                    if (obj.status === "ok") {
                        UIkit.notification({
                            message: '<span uk-icon=\'icon: check\'></span> ' + obj.msg,
                            status: 'success',
                            timeout: 2000
                        });
                    } else {
                        UIkit.notification({
                            message: '<span uk-icon=\'icon: close\'></span> ' + obj.msg,
                            status: 'danger',
                            timeout: 2000
                        })
                    }
                }, "json")
            });
            $(".animal_options").change(function () {
                $.post("declare/animals_change_status?_=" + Date.parse(new Date()), {
                    "id": $(this).attr('_id'),
                    "status": $(this).val()
                }, function (obj) {
                    if (obj.status === "ok") {
                        UIkit.notification({
                            message: '<span uk-icon=\'icon: check\'></span> ' + obj.msg,
                            status: 'success',
                            timeout: 2000
                        });
                    } else {
                        UIkit.notification({
                            message: '<span uk-icon=\'icon: close\'></span> ' + obj.msg,
                            status: 'danger',
                            timeout: 2000
                        })
                    }
                }, "json")
            });
            $(".del").click(function() {
                var _this = $(this);
                $.post("declare/animals_del?_=" + Date.parse(new Date()), {
                    "id":_this.attr("_id")
                }, function(obj) {
                    if (obj.status === "ok") {
                        UIkit.notification({
                            message: '<span uk-icon=\'icon: check\'></span> ' + obj.msg,
                            status: 'success',
                            timeout: 2000
                        });
                        _this.parents("tr").remove();
                    } else {
                        UIkit.notification({
                            message: '<span uk-icon=\'icon: close\'></span> ' + obj.msg,
                            status: 'danger',
                            timeout: 2000
                        })
                    }
                }, "json")
            });
        })
    );
